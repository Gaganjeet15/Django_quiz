<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ category|default:"All Categories" }} Quiz</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.0.0/dist/tailwind.min.css" />
    <style>
      .option-box {
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 12px 16px;
        margin-bottom: 12px;
        cursor: pointer;
        position: relative;
        background-color: #f3f4f6;
        transition: all 0.2s ease;
      }

      .option-box:hover {
        background-color: #e5e7eb;
      }

      .option-box.selected {
        background-color: #dbeafe;
        border-color: #3b82f6;
      }

      .correct-answer {
        background-color: #ecfdf5 !important;
        border: 1px solid #059669 !important;
      }

      .incorrect-answer {
        background-color: #fef2f2 !important;
        border: 1px solid #dc2626 !important;
      }

      .selected-label {
        position: absolute;
        right: 16px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 0.875rem;
        color: #6b7280;
      }

      .check-icon {
        color: #059669;
        margin-right: 8px;
      }

      .x-icon {
        color: #dc2626;
        margin-right: 8px;
      }
    </style>
  </head>
  <body class="bg-gray-100">
    <div class="container mx-auto my-8 max-w-3xl bg-white shadow-md rounded-lg p-6">
      <h1 class="text-3xl font-bold text-gray-800 mb-6">
        {{ category|default:"All Categories" }} Quiz
      </h1>

      <form id="quiz-form" method="POST">
        {% csrf_token %}
        {% for question in questions %}
        <input type="hidden" name="current_question_id" value="{{ question.id }}">
        <div class="mb-8 question-container">
          <h3 class="text-lg font-semibold text-gray-700 mb-4">
            {{ question.question }}
          </h3>

          <!-- Options -->
          <div class="space-y-3">
            {% for option in question.options %}
            <div class="option-box {% if question.feedback %}
                       {% if question.feedback.correct_answer == option %}correct-answer
                       {% elif question.feedback.user_answer == option and not question.feedback.is_correct %}incorrect-answer
                       {% endif %}
                       {% endif %}"
                 onclick="selectOption(this)">
              <input
                type="radio"
                name="question_{{ question.id }}"
                value="{{ option }}"
                id="q{{ question.id }}_{{ forloop.counter }}"
                class="hidden" />
              <label for="q{{ question.id }}_{{ forloop.counter }}" class="cursor-pointer flex items-center">
                {% if question.feedback %}
                  {% if question.feedback.correct_answer == option %}
                    <span class="check-icon">✓</span>
                  {% elif question.feedback.user_answer == option and not question.feedback.is_correct %}
                    <span class="x-icon">✗</span>
                  {% endif %}
                {% endif %}
                {{ option }}
                {% if question.feedback and question.feedback.user_answer == option %}
                  <span class="selected-label">Your Selection</span>
                {% endif %}
              </label>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endfor %}

        <!-- Submit Button (show only when no feedback) -->
        {% if not show_next_options %}
        <button
          type="submit"
          class="w-full px-4 py-2 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 transition-colors duration-200">
          Submit Answer
        </button>
        {% endif %}

        <!-- Buttons for "Answer More" and "End Quiz" (show only after feedback) -->
        {% if show_next_options %}
        <div class="mt-6 flex justify-between">
          <a
            href="{% url 'quiz' %}{% if category != 'All Categories' %}?category={{ category }}{% endif %}"
            class="px-4 py-2 bg-green-600 text-white font-semibold rounded-md hover:bg-green-700 transition-colors duration-200">
            Answer More
          </a>
          <a
            href="{% url 'dashboard' %}"
            class="px-4 py-2 bg-red-600 text-white font-semibold rounded-md hover:bg-red-700 transition-colors duration-200">
            End Quiz
          </a>
        </div>
        {% endif %}
      </form>
    </div>

    <script>
      function selectOption(selected) {
        // Remove selection from all options
        const options = document.querySelectorAll('.option-box');
        options.forEach(option => {
          option.classList.remove('selected');
        });
        
        // Add selection to clicked option
        if (!selected.classList.contains('correct-answer') && !selected.classList.contains('incorrect-answer')) {
          selected.classList.add('selected');
        }
        
        // Check the radio input
        const radio = selected.querySelector('input[type="radio"]');
        radio.checked = true;
      }
    </script>
  </body>
</html>